{% extends "sprout-base-import/_layouts/base" %}
{% import "_includes/forms" as forms %}
{% import 'sprout-base/_includes/sproutcp' as sprout %}

{% set title = 'Seed'|t('sprout-base') %}

{% macro errorList(errors) %}
    {% if errors %}
        <ul class="errors">
            {% for categorizedErrors in errors %}
                {% for error in categorizedErrors %}
                    <li>{{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    {% endif %}
{% endmacro %}

{% from _self import errorList %}

{% block content %}

    {% if seedJob.getErrors()|length %}
        <div class="pane">
            <h3>{{ "Unable to plant seeds."|t('sprout-base') }}</h3>
            {{ errorList(seedJob.getErrors()) }}
        </div>
        <br>
    {% endif %}

    <form method="post" accept-charset="UTF-8">
        {{ csrfInput() }}
        {{ redirectInput('sprout-base/seed') }}
        <input type="hidden" name="action"
               value="sprout-base/seed/generate-element-seeds">

        {{ forms.textField({
            label: 'How many items to seed?'|t('sprout-base'),
            instructions: 'Total number of content items to import.'|t('sprout-base'),
            name: 'quantity',
            placeholder: '11'|t('sprout-base'),
            value: seedJob.quantity ?? 11,
            errors: seedJob.getErrors('quantity') ?? null,
            size: 4,
            first: true
        }) }}

        {{ forms.selectField({
            label: "Type of Content"|t('sprout-base'),
            instructions: "Select the type of content to seed in your database."|t('sprout-base'),
            id: "elementType",
            name: "elementType",
            options: elements,
            value: seedJob.elementType ?? '',
            errors: seedJob.getErrors('elementType') ?? null,
            hasOptgroups: true
        }) }}

        {# Output settings for each of our Importers #}
        {% for key, importer in importers %}
            <div class="field element-options {{ key|replace({'\\': "-"}) }}"
                 style="display: none">
                {{ importer.getSeedSettingsHtml(seedJob)|raw }}
            </div>
        {% endfor %}

        <div class="buttons">
            <button class="btn submit actions">{{ "Generate Content"|t('sprout-base') }}</button>
        </div>
    </form>

{% endblock %}

{% block details %}

    <div class="meta">

        <h2>{{ "Generate fake content"|t('sprout-base') }}</h2>

        <p>{{ "Generate content to work with for front-end prototyping, testing large amounts of content, and more. Any seed data generated will be marked and can later be unmarked or removed using the Weed tab."|t('sprout-base') }}</p>

        <h6>{{ "Supported Elements"|t('sprout-base') }}</h6>

        {% set importers = craft.sproutImport.getSproutImportImporters() %}

        <ul>
            {% for importer in importers %}
                {% if importer.hasSeedGenerator() %}
                    <li>{{ importer.getName() }}</li>
                {% endif %}
            {% endfor %}
        </ul>

        <h6>{{ "Supported Fields"|t('sprout-base') }}</h6>

        {% set fieldImporters = craft.sproutImport.getSproutImportFieldImporters() %}

        <ul>
            {% for importer in fieldImporters %}
                <li>{{ importer.getName() }}</li>
            {% endfor %}
        </ul>

    </div>

{% endblock %}

{% do view.registerAssetBundle("barrelstrength\\sproutbase\\app\\import\\web\\assets\\import\\ImportAsset") %}

{% js %}

    Craft.SproutImport.Seed.init();

    $selectedElementType = $('#elementType').val();
    $selectedElementClass = $selectedElementType.replace(/\\/g, '-');
    $('.'+$selectedElementClass).show();

{% endjs %}